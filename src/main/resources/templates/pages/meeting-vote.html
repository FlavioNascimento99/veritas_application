<div th:fragment="content" class="container mx-auto p-6">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Votação em Reunião Ativa</h1>
        <form th:action="@{/logout}" method="post">
            <button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                Sair (Logout)
            </button>
        </form>
    </div>

    <!-- Info de Reunião Ativa -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
        <h2 class="text-lg font-semibold text-blue-900 mb-2">
            <i class="fas fa-info-circle"></i> Reunião Em Andamento
        </h2>
        <div class="text-sm text-blue-800 space-y-1">
            <p><strong>Reunião:</strong> <span th:text="${meeting.description}"></span></p>
            <p><strong>Status:</strong> <span class="px-2 py-1 bg-orange-200 text-orange-800 rounded text-xs font-bold">EM ANDAMENTO</span></p>
            <p><strong>Colegiado:</strong> <span th:text="${meeting.collegiate.description}"></span></p>
            <p><strong>Processos na Pauta:</strong> <span th:text="${meeting.processes.size()}"></span></p>
        </div>
    </div>

    <!-- Botão Voltar -->
    <div class="mb-6">
        <a th:href="@{/dashboard}" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 inline-flex items-center gap-2">
            <i class="fas fa-arrow-left"></i> Voltar
        </a>
    </div>

    <!-- Mensagens Flash -->
    <div th:if="${successMessage}" class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded">
        <i class="fas fa-check"></i> <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
        <i class="fas fa-exclamation-circle"></i> <span th:text="${errorMessage}"></span>
    </div>

    <!-- Processos para Votação -->
    <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">
            <i class="fas fa-vote-yea"></i> Processos para Votação
        </h3>

        <div th:if="${meeting.processes != null and !meeting.processes.isEmpty()}">
            <div class="space-y-4">
                <div th:each="process : ${meeting.processes}" 
                     class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg border border-indigo-200 shadow">
                    
                    <!-- Cabeçalho do Processo -->
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="text-lg font-bold text-gray-800">
                                <span th:text="${'#' + process.number + ' - ' + process.title}"></span>
                            </h4>
                            <p class="text-sm text-gray-600 mt-1" th:text="${process.description}"></p>
                        </div>
                        <span th:class="'px-3 py-1 rounded-full text-sm font-bold ' + 
                                       (${process.status.name() == 'UNDER_ANALISYS'} ? 'bg-yellow-200 text-yellow-800' : 
                                        ${process.status.name() == 'APPROVED'} ? 'bg-green-200 text-green-800' : 
                                        'bg-red-200 text-red-800')"
                              th:text="${process.status.name()}">
                        </span>
                    </div>

                    <!-- Informações do Relator e Decisão -->
                    <div class="bg-white rounded p-4 mb-4 space-y-2">
                        <div>
                            <strong class="text-gray-700">Relator:</strong>
                            <span class="text-gray-600" th:text="${process.processRapporteur != null ? process.processRapporteur.name : 'Não designado'}"></span>
                        </div>
                        <div>
                            <strong class="text-gray-700">Decisão do Relator:</strong>
                            <span th:if="${process.rapporteurVote}" 
                                  th:class="'px-2 py-1 rounded text-sm font-bold ' + 
                                           (${process.rapporteurVote.name() == 'DEFERIMENTO'} ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800')"
                                  th:text="${process.rapporteurVote.name()}"></span>
                            <span th:if="${!process.rapporteurVote}" class="text-gray-500">Não registrada</span>
                        </div>
                        <div th:if="${process.rapporteurJustification}">
                            <strong class="text-gray-700">Justificativa do Relator:</strong>
                            <p class="text-gray-600 text-sm italic mt-1" th:text="${process.rapporteurJustification}"></p>
                        </div>
                    </div>

                    <!-- Botões de Votação -->
                    <div th:if="${process.status.name() == 'UNDER_ANALISYS'}" class="flex gap-3">
                        <form method="POST" 
                              th:action="@{/dashboard/meetings/{id}/processes/{pid}/vote(id=${meeting.id}, pid=${process.id})}"
                              class="flex-1">
                            <input type="hidden" name="voteType" value="COM_RELATOR">
                            <button type="submit" 
                                    class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded flex items-center justify-center gap-2">
                                <i class="fas fa-thumbs-up"></i> Concordo com Relator
                            </button>
                        </form>
                        <form method="POST" 
                              th:action="@{/dashboard/meetings/{id}/processes/{pid}/vote(id=${meeting.id}, pid=${process.id})}"
                              class="flex-1">
                            <input type="hidden" name="voteType" value="DIVERGENTE">
                            <button type="submit" 
                                    class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded flex items-center justify-center gap-2">
                                <i class="fas fa-thumbs-down"></i> Discordo do Relator
                            </button>
                        </form>
                    </div>

                    <!-- Status de Votação -->
                    <div th:if="${process.status.name() != 'UNDER_ANALISYS'}" class="bg-yellow-50 border border-yellow-200 rounded p-3">
                        <p class="text-sm text-yellow-800">
                            <i class="fas fa-check-circle text-yellow-600"></i>
                            <strong>Processo Apregoado</strong> - Resultado: <span th:text="${process.status.name()}"></span>
                        </p>
                    </div>

                    <!-- Indicador de Voto do Professor Atual -->
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <p class="text-xs text-gray-500">
                            <i class="fas fa-info-circle"></i>
                            <span th:if="${process.status.name() == 'UNDER_ANALISYS'}"
                                  th:text="'Você ainda não votou neste processo'"></span>
                            <span th:unless="${process.status.name() == 'UNDER_ANALISYS'}"
                                  th:text="'Votação encerrada para este processo'"></span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${meeting.processes == null or meeting.processes.isEmpty()}" class="text-center py-8 text-gray-500">
            <p><i class="fas fa-inbox text-3xl mb-2"></i></p>
            <p>Nenhum processo na pauta desta reunião</p>
        </div>
    </div>

    <!-- Informações Adicionais -->
    <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <h4 class="font-semibold text-blue-900 mb-2"><i class="fas fa-lightbulb"></i> Como Funciona</h4>
        <ul class="text-sm text-blue-800 space-y-1">
            <li>✓ Você vota de acordo com a decisão do relator (concordar ou discordar)</li>
            <li>✓ Todos os votos dos membros são computados automaticamente</li>
            <li>✓ O sistema calcula o resultado final (maioria/empate)</li>
            <li>✓ Após votação de todos, o coordenador apregoa o processo</li>
            <li>✓ Quando todos processos estiverem apregoados, a sessão pode ser finalizada</li>
        </ul>
    </div>
</div>
