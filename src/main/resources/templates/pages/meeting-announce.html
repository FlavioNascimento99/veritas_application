<div th:fragment="content" class="container mx-auto p-6">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Apregoação de Processos</h1>
        <form th:action="@{/logout}" method="post">
            <button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                Sair (Logout)
            </button>
        </form>
    </div>

    <!-- Info de Reunião Ativa -->
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
        <h2 class="text-lg font-semibold text-green-900 mb-2">
            <i class="fas fa-gavel"></i> Reunião Em Andamento
        </h2>
        <div class="text-sm text-green-800 space-y-1">
            <p><strong>Reunião:</strong> <span th:text="${meeting.description}"></span></p>
            <p><strong>Status:</strong> <span class="px-2 py-1 bg-orange-200 text-orange-800 rounded text-xs font-bold">EM ANDAMENTO</span></p>
            <p><strong>Colegiado:</strong> <span th:text="${meeting.collegiate.description}"></span></p>
            <p><strong>Processos na Pauta:</strong> <span th:text="${meeting.processes.size()}"></span></p>
        </div>
    </div>

    <!-- Botão Voltar -->
    <div class="mb-6">
        <a th:href="@{/dashboard/meetings}" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 inline-flex items-center gap-2">
            <i class="fas fa-arrow-left"></i> Voltar
        </a>
    </div>

    <!-- Mensagens Flash -->
    <div th:if="${successMessage}" class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded">
        <i class="fas fa-check"></i> <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
        <i class="fas fa-exclamation-circle"></i> <span th:text="${errorMessage}"></span>
    </div>

    <!-- Processos para Apregoação -->
    <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">
            <i class="fas fa-gavel"></i> Processos para Apregoação
        </h3>

        <div th:if="${meeting.processes != null and !meeting.processes.isEmpty()}">
            <div class="space-y-4">
                <div th:each="process : ${meeting.processes}" 
                     class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200 shadow">
                    
                    <!-- Cabeçalho do Processo -->
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="text-lg font-bold text-gray-800">
                                <span th:text="${'#' + process.number + ' - ' + process.title}"></span>
                            </h4>
                            <p class="text-sm text-gray-600 mt-1" th:text="${process.description}"></p>
                        </div>
                        <span th:class="'px-3 py-1 rounded-full text-sm font-bold ' + 
                                       (${process.status.name() == 'UNDER_ANALISYS'} ? 'bg-yellow-200 text-yellow-800' : 
                                        ${process.status.name() == 'APPROVED'} ? 'bg-green-200 text-green-800' : 
                                        'bg-red-200 text-red-800')"
                              th:text="${process.status.name()}">
                        </span>
                    </div>

                    <!-- Informações Críticas -->
                    <div class="bg-white rounded p-4 mb-4 space-y-3">
                        <div class="border-b pb-3">
                            <strong class="text-gray-700">Relator:</strong>
                            <span class="text-gray-600" th:text="${process.processRapporteur != null ? process.processRapporteur.name : 'Não designado'}"></span>
                        </div>
                        <div class="border-b pb-3">
                            <strong class="text-gray-700">Decisão do Relator:</strong>
                            <span th:if="${process.rapporteurVote}" 
                                  th:class="'px-2 py-1 rounded text-sm font-bold ' + 
                                           (${process.rapporteurVote.name() == 'DEFERIMENTO'} ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800')"
                                  th:text="${process.rapporteurVote.name()}"></span>
                            <span th:if="${!process.rapporteurVote}" class="text-gray-500">Não registrada</span>
                        </div>
                        <div th:if="${process.rapporteurJustification}" class="pb-3">
                            <strong class="text-gray-700">Justificativa:</strong>
                            <p class="text-gray-600 text-sm italic mt-1" th:text="${process.rapporteurJustification}"></p>
                        </div>
                        
                        <!-- Resumo de Votos -->
                        <div class="bg-blue-50 rounded p-3 border border-blue-200">
                            <strong class="text-blue-900 block mb-2"><i class="fas fa-chart-pie"></i> Resultado da Votação</strong>
                            <div class="text-sm space-y-1">
                                <p class="text-blue-800" th:if="${process.status.name() == 'UNDER_ANALISYS'}">
                                    ⏳ <strong>Aguardando Apregoação</strong> - Votos registrados
                                </p>
                                <p class="text-green-800" th:if="${process.status.name() == 'APPROVED'}">
                                    ✅ <strong>APROVADO</strong> - Decisão finalizada
                                </p>
                                <p class="text-red-800" th:if="${process.status.name() == 'REJECTED'}">
                                    ❌ <strong>REJEITADO</strong> - Decisão finalizada
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Botão de Apregoação -->
                    <div th:if="${process.status.name() == 'UNDER_ANALISYS'}" class="mt-4">
                        <form method="POST" 
                              th:action="@{/dashboard/meetings/{id}/processes/{pid}/announce(id=${meeting.id}, pid=${process.id})}"
                              onsubmit="return confirm('Tem certeza que deseja apregoar este processo? Isso calculará e finalizará o resultado da votação.');">
                            <button type="submit" 
                                    class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded flex items-center justify-center gap-2">
                                <i class="fas fa-gavel"></i> Apregoar Processo
                            </button>
                        </form>
                    </div>

                    <!-- Status de Apregoação -->
                    <div th:if="${process.status.name() != 'UNDER_ANALISYS'}" class="bg-green-100 border border-green-300 rounded p-3 mt-4">
                        <p class="text-sm text-green-800">
                            <i class="fas fa-check-circle text-green-600"></i>
                            <strong>Processo Apregoado</strong> - Resultado: <span th:text="${process.status.name()}"></span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Resumo Geral -->
            <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <h4 class="font-bold text-gray-800 mb-2"><i class="fas fa-info-circle"></i> Resumo da Reunião</h4>
                <div class="grid grid-cols-3 gap-4 text-sm">
                    <div class="text-center">
                        <p class="text-gray-600">Total de Processos</p>
                        <p class="text-2xl font-bold text-gray-800" th:text="${meeting.processes.size()}"></p>
                    </div>
                    <div class="text-center">
                        <p class="text-gray-600">Apregoados</p>
                        <p class="text-2xl font-bold text-green-600" th:text="${#numbers.formatInteger(meeting.processes.size() - #collections.size(meeting.processes.?[status.name() == 'UNDER_ANALISYS']), 1, 'DEFAULT')}"></p>
                    </div>
                    <div class="text-center">
                        <p class="text-gray-600">Pendentes</p>
                        <p class="text-2xl font-bold text-yellow-600" th:text="${#collections.size(meeting.processes.?[status.name() == 'UNDER_ANALISYS'])}"></p>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${meeting.processes == null or meeting.processes.isEmpty()}" class="text-center py-8 text-gray-500">
            <p><i class="fas fa-inbox text-3xl mb-2"></i></p>
            <p>Nenhum processo na pauta desta reunião</p>
        </div>
    </div>

    <!-- Informações Adicionais -->
    <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <h4 class="font-semibold text-blue-900 mb-2"><i class="fas fa-lightbulb"></i> Fluxo de Apregoação</h4>
        <ul class="text-sm text-blue-800 space-y-1">
            <li>1️⃣ Membros votam em cada processo (concordam ou discordam do relator)</li>
            <li>2️⃣ Você apregoa cada processo um por um</li>
            <li>3️⃣ O sistema calcula automaticamente o resultado (maioria/empate)</li>
            <li>4️⃣ Status muda para APROVADO ou REJEITADO</li>
            <li>5️⃣ Quando todos processos estiverem apregoados, finalize a sessão</li>
        </ul>
    </div>
</div>
